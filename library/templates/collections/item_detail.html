{% extends 'base.html' %}
{% load static %}

<div class="hero-image">
    {% block hero_image %}
        <img src="{% static 'images/candle-inscription-books-compass.jpg' %}" alt="Nav Image">
    {% endblock %}
</div>

{% block main_content %}
<section class="item-details-page">
    <div class="item-details-container">
        <div class="item-details-cover">
            <img src="{{ object.item_image.url }}" alt="Cover Image" />
        </div>

        <div class="item-details-info">
            <h2 class="item-details-title">{{ object.title }}</h2>
            <div class="item-details-description">
                <strong>Author:</strong> {{ object.author.name }}<br>
                <strong>Genre:</strong> {{ object.genre }}<br>
                <strong>Publication Date:</strong> {{ object.publication_date|date:"F j, Y" }}<br>
                <strong>ISBN:</strong> {{ object.isbn }}<br>
                <a href="#" id="open-sample-btn" class="item-details-sample-btn">READ A SAMPLE</a>
            </div>

            <div class="item-details-action-buttons">
                <a href="{% url 'item edit' pk=object.pk slug=object.slug %}" class="item-details-edit">Edit</a>
                <a href="#" class="item-details-remove">Delete</a>
                <button id="save-item-btn" data-item-id="{{ object.id }}" class="heart-button">
                    {% if object in request.user.libraryprofile.saved_items.all %}
                        ‚ù§Ô∏è
                    {% else %}
                        ü§ç
                    {% endif %}
                </button>
            </div>
        </div>
    </div>
</section>

<div id="sample-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>{{ object.title }} - Sample</h2>
        <div class="sample-text">
            <p>{{ object.sample }}</p>
        </div>
    </div>
</div>

<script>
    // Get modal element
    const modal = document.getElementById("sample-modal");
    const btn = document.getElementById("open-sample-btn");
    const span = document.getElementsByClassName("close-btn")[0];

    // Open the modal
    btn.onclick = function(event) {
        event.preventDefault(); // Prevent default link behavior
        modal.style.display = "block";
    }

    // Close the modal when clicking the close button
    span.onclick = function() {
        modal.style.display = "none";
    }

    // Close the modal when clicking outside of it
    window.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    }
</script>

<script>
    document.getElementById('save-item-btn').addEventListener('click', function(event) {
        const itemId = this.getAttribute('data-item-id');
        const itemSlug = '{{ object.slug }}'; // Get the slug from the object

        fetch(`/collections/${itemId}/${itemSlug}/save_item/`, { // Update the URL
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ item_id: itemId })
        })
        .then(response => response.json())
        .then(data => {
            // Update the button's inner HTML based on the response
            document.getElementById('save-item-btn').innerHTML = data.favorited ? '‚ù§Ô∏è' : 'ü§ç';
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
</script>

{% endblock %}
